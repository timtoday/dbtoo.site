---
title: freebsd下ipfw详细配置说明
layout: post
tags:
- FreeBSD
- Firewall
- Kernel
---
<div> # ee /etc/rc.conf<br>复制内容到剪贴板代码:<br>firewall_enable="YES"<br>firewall_type="open"<br>firewall_script="/etc/ipfw.rules"<br>firewall_logging="YES"<br># ee /etc/sysctl.conf<br>复制内容到剪贴板代码:<br>net.inet.ip.fw.verbose=1<br>net.inet.ip.fw.verbose_limit=5<br>编辑防火墙规则<br>复制内容到剪贴板代码:<br># ee /etc/ipfw.rules<br>复制内容到剪贴板代码:<br># 具体语法请参考<a href="http://cnsnap.cn.freebsd.org/doc/zh_CN.GB2312/books/handbook/firewalls-ipfw.html">http://cnsnap.cn.freebsd.org/doc/zh_CN.GB2312/books/handbook/firewalls-ipfw.html</a><br>#<br>##################<br>#启动时重载规则列表#<br>##################<br>ipfw -q -f flush<br>#<br>#############<br>#设置命令前缀#<br>#############<br>cmd="ipfw -q add"<br>#<br>#############<br>#设置DNS地址#<br>#############<br>dns="192.168.163.2"<br>#<br>################<br>#公网网卡界面名称#<br>################<br>pif="lnc0"<br>#<br>################<br>#不限制loopback#<br>################<br>$cmd 00100 allow all from any to any via lo0<br>#<br>###############<br>#允许自定义规则#<br>###############<br>$cmd 00200 check-state<br>#<br>###############<br>#允许与DNS通讯#<br>###############<br>$cmd 00300 allow tcp from any to $dns 53 out via $pif setup keep-state<br>$cmd 00400 allow udp from any to $dns 53 out via $pif keep-state<br>#<br>#####################################################<br>#允许http连接（limit src-addr意为限制同一地址连接数量）#<br>#####################################################<br>$cmd 00500 allow tcp from any to any 80 out via $pif setup keep-state<br>$cmd 00600 allow tcp from any to me 80 in via $pif setup limit src-addr 10<br>#<br>######################################################<br>#允许https连接（limit src-addr意为限制同一地址连接数量）#<br>######################################################<br>$cmd 00700 allow tcp from any to any 443 out via $pif setup keep-state<br>$cmd 00800 allow tcp from any to me 443 in via $pif setup limit src-addr 10<br>#<br>#######################################################<br>#允许收发电子邮件（limit src-addr意为限制同一地址连接数量）#<br>#######################################################<br>$cmd 00900 allow tcp from any to any 25 out via $pif setup keep-state<br>#$cmd 01000 allow tcp from any to me 25 in via $pif setup limit src-addr 1<br>#<br>$cmd 01100 allow tcp from any to any 110 out via $pif setup keep-state<br>#$cmd 01100 allow tcp from any to me 110 in via $pif setup limit src-addr 1<br>#<br>#########################<br>#允许CVSP和PORT安装/更新#<br>#########################<br>$cmd 01200 allow tcp from any to any via $pif setup keep-state uid root<br>#<br>##########<br>#允许ping#<br>##########<br>$cmd 01300 allow icmp from any to any out via $pif keep-state<br>#$cmd 01300 allow icmp from any to any in via $pif keep-state<br>#<br>####################################################<br>#允许FTP连接（limit src-addr意为限制同一地址连接数量）#<br>####################################################<br>$cmd 01400 allow tcp from any to any 21 out via $pif setup keep-state<br>$cmd 01500 allow tcp from any to any 21 in via $pif setup limit src-addr 2<br>#<br>########################################################<br>#允许SSH远程连接（limit src-addr意为限制同一地址连接数量）#<br>########################################################<br>$cmd 01600 allow tcp from any to any 22 out via $pif setup keep-state<br>$cmd 01700 allow tcp from any to any 22 in via $pif setup limit src-addr 2<br>#<br>######################<br>#禁止此规则以外的所有连接#<br>######################<br>$cmd 60000 deny log all from any to any<br> </div>