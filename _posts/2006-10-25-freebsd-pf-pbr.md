---
title :  freebsd 双线策略路由(pf方法)
layout :  post
tags : 
- FreeBSD
- Firewall
- Kernel
---
 
<div> <p>device pf<br>options ALTQ<br>options ALTQ_CBQ<br>options ALTQ_RED<br>options ALTQ_RIO<br>options ALTQ_HFSC<br>options ALTQ_CDNR<br>options ALTQ_PRIQ</p><p>Note :  If you are installing altq on a multiprocessor system, add options ALTQ_NOPPC to your configuration before you recompile your kernel.</p><p> </p><p><br># vi /etc/pf.conf<br>=================================================<br>if_isp1="fxp0"<br>if_isp2="ne3"<br>gw_isp1="192.168.0.1"<br>gw_isp2="192.168.1.10"</p><p>block all</p><p>pass quick on lo0 all</p><p>pass in quick on $if_isp1 reply-to ( $if_isp1 $gw_isp1 ) proto {tcp,udp,icmp} to any keep state<br>pass in quick on $if_isp2 reply-to ( $if_isp2 $gw_isp2 ) proto {tcp,udp,icmp} to any keep state</p><p>pass out keep state<br>=================================================</p><p>为了试验方便，以上PF规则没有对TCP/UDP等协议的端口进行限制。大家根据自己的实际情况修改一下即可。为了方便控制PF的启动和关闭，下面列出我使用的一个SHELL脚步：</p><p># vi /etc/rc.d/pf.sh<br>=================================================<br>#!/bin/sh<br># made by llzqq<br># pf startup scripts<br>#</p><p>case "$1" in</p><p>start)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if [ -f /etc/pf.conf ]; then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  /sbin/pfctl -e -f /etc/pf.conf<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  fi<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ;;</p><p>stop)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  /sbin/pfctl -F all<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  /sbin/pfctl -d<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ;;<br>*)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  echo "$0 start | stop"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ;;</p><p>esac<br>exit 0</p> </div>