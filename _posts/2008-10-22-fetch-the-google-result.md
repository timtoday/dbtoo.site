---
title:极限模拟抓取google结果
layout: post
tags:
- Python
- Http
---
<div> 试过用urllib,curl,httpclient......而且都用上了cookielib<p><img src="http://img.baidu.com/hi/tsj/t_0008.gif"/>google太严厉了，cookie都发过去了，还是返回503......</p><p> </p><p>于是采用一个变态的模拟浏览器的方法：</p><p> </p><p>于是找到了mechanize（一个开源的浏览器内核，支持linux,windows系统）</p><p>二话不说直接</p><p> <br/>    br = mechanize.Browser()<br/>    cj = cookielib.LWPCookieJar()<br/>    br.set_cookiejar(cj)</p><p>    r = br.open('<a href="http://www.google.com.hk/search?hl=zh-CN&amp;source=hp&amp;biw=1280&amp;bih=885&amp;q=kk&amp;aq=f&amp;aqi=&amp;aql=&amp;oq=&amp;gs_rfai=">http://www.google.com.hk/search?hl=zh-CN&amp;source=hp&amp;biw=1280&amp;bih=885&amp;q=kk&amp;aq=f&amp;aqi=&amp;aql=&amp;oq=&amp;gs_rfai=</a>')</p><p>    print r.read()</p><p>.................................结果还是503.<img src="http://img.baidu.com/hi/tsj/t_0009.gif"/></p><p>于是仔细研究了 mechanize的方法，居然还有js操作部分功能，于是对上面功能作了一下扩展如下：</p><p>    # Browser<br/>    br = mechanize.Browser()<br/>    cj = cookielib.LWPCookieJar()<br/>    br.set_cookiejar(cj)<br/>    # Browser options<br/>    br.set_handle_equiv(True)<br/>    br.set_handle_gzip(True)<br/>    br.set_handle_redirect(True)<br/>    br.set_handle_referer(True)<br/>    br.set_handle_robots(False)<br/>    br.set_handle_refresh(mechanize._http.HTTPRefreshProcessor(), max_time=1)<br/>    br.addheaders = [('User-agent', 'Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.1) Gecko/2008071615 Fedora/3.0.1-1.fc9 Firefox/3.0.1')]<br/>  //先打开首页<br/>    r = br.open('http://google.com')<br/>    html = r.read()<br/>    br.select_form(nr=0)<br/>    //在首页表单里填入关键词<br/>    br.form['q']='开发'</p><p>    //提交表单<br/>    br.submit()<br/>    print br.response().read()</p><p>  //哇 出来了......<img src="http://img.baidu.com/hi/tsj/t_0021.gif"/>    </p><p> </p><br/> </div>